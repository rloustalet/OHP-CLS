%%%%%%%
% rapportEtudFdS.sty
% 
% Style LaTeX pour les rapports des étudiants de la FdS Montpellier
% conçu pour PDFLaTeX
% -- feuille de style
% 
% Auteur : Julien Morin <julien.morin@umontpellier.fr>
% Date   : 21/11/2017 
%%%%%%%

%%%%%%%%%%%%%%%% Reglages généraux %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{sty/rapportEtudFdS-settings}

%%%%%%%%%%%%%%%% Abbréviations journaux %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{sty/journal}

%%%%%%%%%%%%%%%% Personnalisation du titre %%%%%%%%%%%%%%%%%%%%
%%% options définissant la formation

\newtoggle{munaccp}
\newtoggle{mdeuxas}
\newtoggle{mdeuxccp}
%%%
% \newif\if@mdeuxccp\@mdeuxccpfalse
\renewcommand\maketitle{%
\pgfdeclareimage[height=0.9cm]{umontpellier-logo}{umontpellier-logo}
\begin{titlepage}%
\begin{pgfpicture}{0cm}{0cm}{0cm}{0cm}
\end{pgfpicture}
\let\footnotesize\small
\let\footnoterule\relax
\let \footnote \thanks
\null\vfil
\vskip 60\p@
\begin{center}%
  {\LARGE \bfseries \fontfamily{phv} \@title \par}%
  \vskip 3em%
  {\large \bfseries \fontfamily{phv} 
    \lineskip .75em%
    \begin{tabular}[t]{c}%
      \@author
    \end{tabular}\par}%
    \vskip 1.5em%
  {\large \bfseries \fontfamily{phv} \@date \par}%       % Set date in \large size.
  % Parcours + UE
  \vskip 1.5em%
  \iftoggle{munaccp}{%
    {\large \bfseries \fontfamily{phv} Master 1 \quad Astrophysique Cosmos Champs et Particules \\}}{}
  \iftoggle{mdeuxas}{%
    {\large \bfseries \fontfamily{phv} Master 2 \quad Astrophysique\\}}{}
  \iftoggle{mdeuxccp}{%
    {\large \bfseries \fontfamily{phv} Master 2 \quad Cosmos Champs et Particules\\}}{}
  %
  \vskip.3em
  %
  \iftoggle{munaccp}{%
    {\large \bfseries \fontfamily{phv} %
    HAP~703P -- Atelier Astrophysique Observationnelle}}{}
  \ifboolexpr { togl{mdeuxas} or togl {mdeuxccp} }{%
    {\large \bfseries \fontfamily{phv} %
    HAP~905P -- Atelier Astrophysique Observationnelle}}{}
  
  % cover picture
  \vskip 2.5em%
  \includegraphics[height=0.35\textheight]{fig/cover}
\end{center}\par
% logos
\vfill
%   \ifmdeuxas
  \iftoggle{mdeuxas}{
  \pgfputat{\pgfxy(1.5,0.7)}{\pgfbox[left,center]{%
	{\includegraphics[height=1.7cm]{sty/logo-ucbl}}}
    }
  \pgfputat{\pgfxy(9.5,0.90)}{\pgfbox[left,center]{%
	{\includegraphics[height=1.7cm]{sty/logo-lyon1}}}
    }
  }{}
%   \fi
  \pgfputat{\pgfxy(0.7,-2.0)}{\pgfbox[left,center]{%
	{\includegraphics[height=1.8cm]{sty/umontpellier-logo_filet_noir}}}
    }
  \pgfputat{\pgfxy(8.0,-2.0)}{\pgfbox[left,center]{%
	{\includegraphics[height=1.5cm]{sty/fds-logo}}}
    }
  \pgfputat{\pgfxy(14.5,-2.0)}{\pgfbox[left,center]{%
	{\includegraphics[height=1.5cm]{sty/dephy-logo}}}
    }
  \begin{center}%
  \end{center}\par
\end{titlepage}%
\setcounter{footnote}{0}%
\global\let\thanks\relax
\global\let\maketitle\relax
\global\let\@thanks\@empty
\global\let\@author\@empty
\global\let\@date\@empty
\global\let\@title\@empty
\global\let\title\relax
\global\let\author\relax
\global\let\date\relax
\global\let\and\relax
% \cleardoublepage
}
% 
%%%%%%%%%%%%%%%%% Personnalisation des sections %%%%%%%%%%%%%%%%%%%%
\newcommand{\sectionfont}{%
  \fontencoding{\encodingdefault}%
  \fontfamily{cmr}%
  \fontseries{m}%
  \fontshape{n}%
  \selectfont}

\renewcommand{\section}{\@startsection %
                      {section}{1}{\z@}%
                      {-2.0ex \@plus -1ex \@minus -1.0ex}%
                      {1.2ex \@plus.2ex}%
                      {\sectionfont\large\bfseries}}

\renewcommand{\subsection}{\@startsection %
                      {subsection}{2}{\z@}%
                      {-2.0ex \@plus -1ex \@minus -1.0ex}%
                      {1.2ex \@plus.2ex}%
                      {\sectionfont\bfseries}}

\renewcommand{\subsubsection}{\@startsection %
                             {subsubsection}{3}{\z@}%
                             {-1.75ex\@plus -.2ex \@minus -.2ex}%
                             {1.0ex \@plus .2ex}%
                             {\sectionfont\normalsize\bfseries}}

\renewcommand{\paragraph}{\@startsection{paragraph}{4}{\z@}%
                                    {0.5ex \@plus.1ex \@minus0ex}%
                                    {-1em \@minus .2em}%
                                    {\normalfont\normalsize\bfseries}}

%%%%%%%%%%%%%%% Bibliographie %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewenvironment{thebibliography}[1]
     {\section*{\bibname}%
%       \addcontentsline{toc}{chapter}{\bibname}
      \@mkboth{\MakeUppercase\bibname}{\MakeUppercase\bibname}%
      \list{\@biblabel{\@arabic\c@enumiv}}%
           {\settowidth\labelwidth{\@biblabel{#1}}%
            \leftmargin\labelwidth
            \advance\leftmargin\labelsep
            %%% reduce itemsep in biblio
            \itemsep\z@skip 
            \parsep\z@skip 
            %%%
            \@openbib@code
            \usecounter{enumiv}%
            \let\p@enumiv\@empty
            \renewcommand\theenumiv{\@arabic\c@enumiv}}%
      \sloppy
      \clubpenalty4000
      \@clubpenalty \clubpenalty
      \widowpenalty4000%
      \sfcode`\.\@m}

%%%%%%%%%%%%% Page blanche après chapitre si nécessaire %%%
% \makeatletter
% %
% \def\cleardoublepagetitle{\clearpage \ifodd\c@page\else
%   \hbox{}
%   \vspace*{\fill}
%   \begin{center}
%     ~
%   \end{center}
%   \vspace{\fill}
%   \thispagestyle{empty}
%   \newpage
%   \fi}
% %
% \def\cleardoublepage{\clearpage \ifodd\c@page\else
%   \hbox{}
%   \vspace*{\fill}
%   \thispagestyle{empty}
%   \begin{center}
%     ~
%   \end{center}
%   \vspace{\fill}
%   \newpage
%   \fi}
% %
% \makeatother

%%%%%%%%%%%%%%%%%% Def variables pour couverture %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\newcommand{\module}{\@dblarg\@module}
\long\def\@module[#1]#2{%
  \def\insertmodule{#2}%
  \def\@shortmodule{#1}%
  \def\insertshortmodule{#1}%
  }
\module{}
% 
\newcommand{\annee}{\@dblarg\@annee}
\long\def\@annee[#1]#2{%
  \def\insertannee{#2}%
  \def\@shortannee{#1}%
  \def\insertshortannee{#1}%
  }
\annee{}
\makeatother

%%%%%%%%%%%%%%% En têtes et pieds de pages %%%%%%%%%%%%%%%%%%%%%%%%%
\fancypagestyle{empty}{
  \fancyhf{}
%   \fancyfoot[]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

\fancypagestyle{plain}{
  \fancyhf{}
%   \fancyfoot[]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

\fancypagestyle{main}{
  \fancyhf{}
  \fancyhfoffset[ROE]{6mm}%
  \fancyfoot[RE]{\thepage}%
  \fancyfoot[LO]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0.5pt}
}

%%%%%%%%%%%%%% Hyperref chargé en dernier %%%%%%%%%%%%%%
\RequirePackage{hyperref}
